PBR 材质原理介绍
================

PBR是个不老不新的话题，很早它就出现在预渲染的渲染器里，随着硬件越来越快，尤其是显卡，最近几年逐渐的开始应用到实时渲染中来。

今天就和大家一起来聊聊引入PBR以后，我们怎么来正确的理解和应用

PBR即基于物理的渲染，渲染包括灯光，shader, 材质，
贴图，以及他们之前如何交互影响的，今天的演容主要分三部分。

1.真实世界的光，材质，以及他们之间的交互是如何的。

2.在各种软件里是如何来模拟真实世界的。

3.我们该怎么做才是正确的。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054602.jpg)

要学会使用PBR首先需要了解什么是PBR，需要从真实世界的这些PBR材质特有的属性拆分开来去了解他们，这样我们就需要了解光，物体表面材质以及光是如何与材质交互的。
光包括了颜色，亮度，衰减，强度，形状等主要属性，真实的世界中永远是多光源并存。

自然界中的材质是如何跟光交互的呢？灯光照射到物体表面后两种情况，反射或继续前行折射。折射后的光线被吸收（一般转化为热），或离散。光线被吸收的行为不是发生在表面，而是次表面，或者内部反射不会带出任何颜色。

吸收会使光线强度降低，吸收某一光谱的光线，余下的光线颜色变化，但方向不变

离散后方向改变，强度不变这里。

对于绝缘体和导体，两者与光的交互是完全不同的。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054558.jpg)

* *绝缘体，即非金属的反射率普遍很低，一般在2%-8%左右，大部分光线进行折射，折射后的光线或者被吸收，或者重新离散出来。这部分折射的光线吸收率和材质的明度有关，暗的吸收多，亮的吸收少；离散后光线的颜色也取决于物体表面颜色；

对于导体，即金属，反射率普遍很高，达到70%-100%，所以大部分光线会以镜面反射的形式反弹回来。小部分光线折射后完全被吸收（光是一种粒子，被导体吸收），不同的金属吸收不同波长的光线，导致镜面反射回的光线带有颜色；

漫射和镜面反射：漫射为反射光线方向随机，不一致；镜面反射为一个方向。镜面反射会根据物体表面的粗糙程度表现不同结果。但无论光滑粗糙，反射的总能量是一样的，而且光线反射后的强度不变。漫射是光线被折射的表现。光线从一种媒介进入另一种媒介，并在里面经过多次的散射后从近似入射点的位置返回原来的介质中。漫射过程中除了光线的离散光线还会被吸收（转化成热能）。光线进入介质不深，那么进入点和离开点的差别就可以被忽略。那种光线离散性高，但吸收性弱的材质有时指参与介质或者叫透明材质。比如烟，牛奶，皮肤，翡翠，大理石等。
*    *

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054600.jpg)

而在更细微的层面，比如显微镜下，微表面就是物体表面细微的不规则。根据不同的流程可以叫粗糙度，光滑度，光泽度。表面的不规则度其实对于漫反射的影响视觉上不大，因为漫射的这种离散和吸收过程是发生在材质内部的而非表面。

微表面理论就是建立在物体表面这种细微不规则性的基础上的。可以把它看作许许多多不同方向的面，这些面就叫做微表面。光线对于这些面对入射角都是不一样的，反弹后的角度也不一样，并且有的地方被挡住，有的地方会产生阴影，视觉上会产生模糊的反射。

我们可以通过BRDF来了解软件里面是如何模拟光线的。

BRDF 双向反射分布函数（Bidirectional Reflectance Distribution
Function，BRDF），是场景中的光照射到材质表面反射到视点的光亮度计算方法函数，来定义材质属性。它描述了入射光线经过某个表面反射后如何在各个出射方向上分布，这可以是从理想镜面反射到漫反射。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-54603.jpg)

通过一些简单的参数，我们可以在引擎中用来区分不同类型材质的反射特性。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-54557.jpg)

在UE4材质里面，每一个input都有着各自的特性，他们的组合成为了一个个不同属性的物理材质。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054553.jpg)

通过一个简单的Metallic参数的调整，我们就可以轻易区分两个完全不同的材质。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054556.jpg)

物体表面的反光属性也是这样一个非常重要的参数，通过这张图片，我们就能够非常清晰的区分开来。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054601.jpg)

PBR材质是未来的标准，在传统材质转换到PBR材质的过程当中，我们会遇到很多的挑战。对于传统贴图到PBR贴图没有一键转换的工具，因为有些信息计算机是无法猜测出来的，还是需要主观去判断。目前有两种PBR流程贴图转换可以使用工具。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-54554.jpg)

现在的灯光有直射光，阴影，也有间接光，间接反射等，所以贴图上不需要把灯光信息画上去，只要专注于表达材质属性。我们不需要画高光颜色（反色）来达到一个看上去是白色的；线性空间渲染意味着对于basecolor的明度范围大概30-50
到180-250

能量守恒使得高光如何怎么变都不会增加或减少，就不需要手动的来调整贴图使得粗糙的地方高光贴图暗，光滑的地方高光贴图亮。这时候就需要用已有的信息或修改后生成roughness，Cavity:来定义微表面的变化。

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054555.jpg)

![](http://ox55f9bg6.bkt.clouddn.com/2017-10-04-054603.jpg)
